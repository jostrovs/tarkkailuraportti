<!doctype html>

<html lang="fi">

<head>
    <meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <LINK REL="SHORTCUT ICON" HREF="http://www.lentopalloerotuomarit.fi/tuomaritarkkailu/favicon.ico" />
    
    <title>Lokiluki</title>
    <meta name="description" content="Tarkkailuraportit">
    <meta name="author" content="Jori Ostrovskij">

	<!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->

	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/toastr.min.css">
    <link rel="stylesheet" href="css/pikaday.css">
    <link rel="stylesheet" href="css/log.css">

    <script src="js/lib/jquery-3.1.1.js"></script>
    <script src="js/lib/moment.js"></script>
    <script src="js/lib/pikaday.js"></script>
	<script src="js/lib/bootstrap.min.js"></script>
	<script src="js/lib/toastr.min.js"></script>
    <script src="js/lib/vue.js"></script>
    <script src="js/vue-components.js"></script>


    <script>
    var EVENT_RAPORTIT_UPDATE="";
    var EVENT_RAPORTTI_VALITTU = "EVENT_RAPORTTI_VALITTU";
    var bus = new Vue({
        methods: {
            on: function(event, callback){
                this.$on(event, callback);
            },
            emit: function(event, payload){
                this.$emit(event, payload);
            }
        }
    });

    var fetchData = function(){
        $.ajax({
            url: "./api/log/log.json",
            dataType: "text",
            success: function (data){
                data = data.substring(0, data.length-2);
                arr = JSON.parse("[" + data + "]");

                for(let i=0;i<arr.length;++i) arr[i].id=i+1;
                arr.reverse();
                initApp(arr);
            },
        });
    };

    var initApp = function(data_in){
        var app = new Vue({
            el: '#app',
            data: {
                data: data_in,
                options: 
                { 
                    columns: [
                        { title: 'Date', key: 'date', width: 150, template: function(row){ return moment(row['date']).format("YYYY-MM-DD HH:mm:ss")}},
                        { title: 'Level', key: 'level', width: 30},
                        { title: 'Name', width: 180, key: 'name'},
                        { title: 'Role', width: 2, key: 'role', template: function(row){ return row['role']} },
                        { title: 'Ip', width: 150, key: 'ip'},
                        { title: 'Browser', key: 'browser', width: 120 },
                        { title: 'Msg', key: 'msg', width: 500 },
                        { title: 'id', key: 'id', hidden: true },
                    ], 
                }, 
            },
        });

    }

    $(document).ready(fetchData);
    
    </script>
</head>

<body>
    <div id="app">

        <vue-jos-grid :options="options" :data="data" jos="false" date_filter="ALL" user_filter="ALL"></vue-jos-grid>

    </div>
</body>

</html>